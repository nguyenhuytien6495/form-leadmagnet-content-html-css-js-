<div class="uk-panel uk-margin" data-id="page#5-2-0-0" data-element="" id="app-deals">
    <!-- Header Row -->
    <div data-id="page#5-2-0-0-0" id="page#36" class="uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-0-0">
            <div class="uk-panel table-row-head uk-margin uk-text-center" data-id="page#5-2-0-0-0-0-0" data-element="">
                AVADA APPS
            </div>
        </div>
        <div class="uk-width-expand@m" data-id="page#5-2-0-0-0-1">
            <div class="uk-panel table-row-head uk-margin" data-id="page#5-2-0-0-0-1-0" data-element="">
                OFFERS
            </div>
        </div>
    </div>

    <!-- Joy Loyalty Row -->
    <div data-id="page#5-2-0-0-1" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-1-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-1-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173110/logo-joy.png"
                            alt="Joy Loyalty" loading="lazy" class="el-image">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="joy-loyalty">Joy Loyalty
                        </h3>
                        <div class="el-content uk-panel">Boost customer retention and maximized ROI with modern loyalty
                            programs</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-1-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-1-1-0" data-element="">
                <div class="text-priamry">BFCM – 30% for 6 months</div>
                <div class="text-secondary">Ends: Dec 31, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-1-2">
            <div data-id="page#5-2-0-0-1-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#" aria-label="Joy Button">Claim Joy</a>
            </div>
        </div>
    </div>

    <!-- Chatty Row -->
    <div data-id="page#5-2-0-0-2" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-2-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-2-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173108/logo-meetchatty.png"
                            width="54" height="54" alt="Chatty" loading="lazy" class="el-image uk-object-cover"
                            style="aspect-ratio: 54 / 54;">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="chatty">Chatty</h3>
                        <div class="el-content uk-panel">The AI-first chat platform for eCommerce sales</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-2-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-2-1-0" data-element="">
                <div class="text-priamry">BFCM – 40% off for 3 months (new customers)</div>
                <div class="text-secondary">Ends: Dec 31, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-2-2">
            <div data-id="page#5-2-0-0-2-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#" aria-label="Chatty Button">Claim
                    Chatty</a>
            </div>
        </div>
    </div>

    <!-- AOV Free Gift Row -->
    <div data-id="page#5-2-0-0-4" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-4-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-4-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173105/logo-aov.png"
                            width="54" height="54" alt="AOV Free Gift" loading="lazy" class="el-image uk-object-cover"
                            style="aspect-ratio: 54 / 54;">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="aov-free-gift">AOV Free
                            Gift</h3>
                        <div class="el-content uk-panel">Sell more, do less with AI-driven upsells</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-4-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-4-1-0" data-element="">
                <div class="text-priamry">BFCM – 30% 2 months</div>
                <div class="text-secondary">Ends: Dec 31, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-4-2">
            <div data-id="page#5-2-0-0-4-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#">Claim AOV</a>
            </div>
        </div>
    </div>

    <!-- PDF Invoice Row -->
    <div data-id="page#5-2-0-0-5" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-5-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-5-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173103/logo-PDF-invoid.png"
                            width="54" height="54" alt="PDF Invoice" loading="lazy" class="el-image uk-object-cover"
                            style="aspect-ratio: 54 / 54;">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="pdf-invoice">PDF Invoice
                        </h3>
                        <div class="el-content uk-panel">Automated invoices help you save time and stay compliant</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-5-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-5-1-0" data-element="">
                <div class="text-priamry">BFCM – 50% 3 months</div>
                <div class="text-secondary">Ends: Dec 01, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-5-2">
            <div data-id="page#5-2-0-0-5-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#">Claim PDF Invoice</a>
            </div>
        </div>
    </div>

    <!-- Avada Order Limit Row -->
    <div data-id="page#5-2-0-0-6" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-6-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-6-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173103/logo-PDF-invoid.png"
                            width="54" height="54" alt="Avada order limit" loading="lazy"
                            class="el-image uk-object-cover" style="aspect-ratio: 54 / 54;">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="avada-order-limit">Avada
                            Order Limit</h3>
                        <div class="el-content uk-panel">Set minimum/maximum order quantity &amp; value with checkout
                            rules</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-6-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-6-1-0" data-element="">
                <div class="text-priamry">BFCM – 50% first month</div>
                <div class="text-secondary">Ends: Dec 01, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-6-2">
            <div data-id="page#5-2-0-0-6-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#">Claim Order Limit</a>
            </div>
        </div>
    </div>

    <!-- SEA Survey Row -->
    <div data-id="page#5-2-0-0-7" class="table-row-data has-coupon uk-grid tm-grid-expand uk-grid-collapse" uk-grid="">
        <div class="uk-width-medium@m uk-first-column" data-id="page#5-2-0-0-7-0">
            <div class="uk-panel info-app uk-margin" data-id="page#5-2-0-0-7-0-0" data-element="">
                <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid="">
                    <div class="uk-width-auto uk-first-column">
                        <img decoding="async"
                            src="https://avadaio_assets.storage.googleapis.com/uploads/2025/10/16173118/logo-sea-survey.png"
                            width="54" height="54" alt="SEA Survey" loading="lazy" class="el-image uk-object-cover"
                            style="aspect-ratio: 54 / 54;">
                    </div>
                    <div class="uk-width-expand uk-margin-remove-first-child">
                        <h3 class="el-title uk-margin-remove-top uk-margin-remove-bottom" id="sea-survey">SEA Survey
                        </h3>
                        <div class="el-content uk-panel">Using post purchase survey &amp; exit intent for customer
                            insights</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-width-expand uk-width-large@m" data-id="page#5-2-0-0-7-1">
            <div class="uk-panel uk-margin" data-id="page#5-2-0-0-7-1-0" data-element="">
                <div class="text-priamry">BFCM – 50% 3 months</div>
                <div class="text-secondary">Ends: Dec 01, 2025</div>
            </div>
        </div>
        <div class="uk-width-auto uk-width-expand@m" data-id="page#5-2-0-0-7-2">
            <div data-id="page#5-2-0-0-7-2-0" data-element="" class="uk-width-1-1">
                <a class="uk-button uk-button-secondary uk-width-1-1" href="#">Claim SEA Survey</a>
            </div>
        </div>
    </div>
</div>


<div id="email-deals" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <h3 class="uk-modal-title">Get your BFCM code for <span class="asset-name"></span></h3>
        <p class="avada-modal-meta">Limited-time offer. Enter your work email to reveal your code and install now.</p>
        <div>
            <form class="form-email-deals" novalidate="">
                <label for="lead-email" class="sr-only uk-hidden">Email address</label>
                <input id="lead-email" name="email" type="email" placeholder="Enter your email"
                    class="form-email-deals__input uk-input" autocomplete="email" inputmode="email" required
                    aria-describedby="email-status">

                <!-- Honeypot for bots -->
                <label for="asset-name" class="sr-only uk-hidden">asset-name</label>
                <input id="asset-name" name="asset-name" type="text" class="form-email-deals__hp uk-hidden"
                    tabindex="-1" aria-hidden="true" autocomplete="off">

                <label for="lead-company" class="sr-only uk-hidden">Company</label>
                <input id="lead-company" name="company" type="text" class="form-email-deals__hp uk-hidden" tabindex="-1"
                    aria-hidden="true" autocomplete="off">

                <div class="form-email-deals__status" aria-live="polite"></div>

                <button type="submit" class="uk-button uk-button-secondary form-email-deals__btn"
                    aria-label="Download all"></button>
            </form>
            <div class="form-email-deals__status-notification" aria-live="polite"></div>
        </div>
    </div>
</div>

<style>
    #email-deals.uk-open {
        display: flex !important;
    }

    #email-deals {
        justify-content: center;
        align-items: center;
    }

    #email-deals .uk-modal-body {
        width: 850px;
        border-radius: 20px;
        border: 3px solid #FFF;
        background: #FFF;
        box-shadow: 0 0 18px 0 #FF6D6A inset;
        backdrop-filter: blur(36px);

        padding: 72px 50px 60px 50px;
    }

    #email-deals .uk-modal-title {
        color: #080099;
        text-align: center;
        font-size: 48px;
        font-weight: 600;
    }

    #email-deals .avada-modal-meta {
        color: #03003D;
        text-align: center;
        font-size: 18px;
    }

    #email-deals .uk-close {
        color: #FF6D6A;
        border: 1px solid #FF6D6A;
        border-radius: 50%;
        padding: 8px;
        top: 20px;
        right: 20px;
    }

    .form-email-deals {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
    }

    .form-email-deals .uk-input {
        height: 55px;
        border-radius: 40px;
        background: rgba(255, 255, 255, 0.20);
        padding: 0 30px;

        text-align: center;

        font-size: 18px;
        color: #03003D;
        font-weight: 600;
    }

    .form-email-deals .uk-input::placeholder {
        font-size: 18px;
        color: #ccc;
    }

    .form-email-deals .uk-button {
        white-space: nowrap;
    }

    .form-email-deals .cf7-cooldown-hint,
    .form-email-deals .wpcf7-not-valid-tip {
        position: absolute;
    }

    .form-email-deals .wpcf7-spinner {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }

    .form-email-deals .wpcf7-form-control-wrap {
        width: 100%;
    }

    .form-email-deals__status {
        font-size: 0px;
        position: absolute;
    }

    .form-email-deals__status-notification {
        min-height: 20px;
        font-size: 14px;
        text-align: center;
        color: #03003D;
    }

    @media (max-width: 479px) {
        #email-deals .uk-modal-body {
            padding: 40px 20px 32px 20px;
        }

        #email-deals .uk-modal-title {
            font-size: 32px;
        }
    }
</style>


<div id="email-coupon" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <h3 class="uk-modal-title">Time to Plan!</h3>
        <p class="avada-modal-meta">Limited-time offer. Enter your work email to reveal your code and install now.</p>
        <div class="code-coupon">BFCM</div>
        <a href="#" class="uk-button uk-button-secondary">Redeem now</a>
        <a href="#" class="link-landing-page"></a>
    </div>
</div>

<style>
    #email-coupon.uk-open {
        display: flex !important;
    }

    #email-coupon {
        justify-content: center;
        align-items: center;
    }

    #email-coupon .uk-modal-body {
        width: 850px;
        border-radius: 20px;
        border: 3px solid #FFF;
        background: #FFF;
        box-shadow: 0 0 18px 0 #FF6D6A inset;
        backdrop-filter: blur(36px);

        padding: 72px 50px 60px 50px;
        display: flex;
        flex-direction: column;
    }

    #email-coupon .uk-modal-title {
        color: #080099;
        text-align: center;
        font-size: 48px;
        font-weight: 600;
        margin: 0 !important;
    }

    #email-coupon .code-coupon {
        margin-bottom: 20px;
        text-transform: uppercase;
        color: #080099;
        text-align: center;
        font-size: 56px;
        font-weight: 700;
    }

    #email-coupon .uk-button {
        width: fit-content;
        margin: 0 auto;
    }

    #email-coupon .avada-modal-meta {
        color: #0e002f;
        margin-top: 0;
        font-weight: 600;
        text-align: center;
        font-size: 18px;
    }

    #email-coupon .uk-close {
        color: #FF6D6A;
        border: 1px solid #FF6D6A;
        border-radius: 50%;
        padding: 8px;
        top: 20px;
        right: 20px;
    }

    #email-coupon .link-landing-page {
        color: #0e002f;
        font-weight: 600;
        text-decoration: underline;
        text-align: center;
        margin-top: 16px;
    }

    @media (max-width: 479px) {
        #email-coupon .uk-modal-body {
            padding: 40px 20px 32px 20px;
        }

        #email-coupon .uk-modal-title {
            font-size: 32px;
        }

        #email-coupon .code-coupon {
            font-size: 26px;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Map app name -> coupon
        const coupons = {
            'Joy Loyalty': {
                code: 'JOY-BFCM2025',
                url: 'https://apps.shopify.com/joyio?utm_source=avada&utm_medium=landingpage&utm_campaign=bfcm2025',
                textUrl_landingpage: "Discover what's inside Joy's BFCM landing page ➔",
                url_landingpage: 'https://joy.so/bfcm-2025/?utm_campaign=bfcm2025&utm_medium=landingpage&utm_source=avada',
                textBtn_getcode: 'Get Joy Code'
            },
            'AOV Free Gift': {
                code: 'BFCM',
                url: 'https://apps.shopify.com/avada-upsell?utm_source=landing_page&utm_medium=card_app_collection&utm_campaign=bfcm',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get AOV Code'
            },
            'Chatty': {
                code: 'BFCM-40OFF-3MO',
                url: 'https://apps.shopify.com/chatty?utm_source=avada.io&utm_medium=web_button&utm_campaign=bfcm25&utm_content=get_40%25_off',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get Chatty Code'
            },
            'PDF Invoice': {
                code: 'BFCMPDF50',
                url: 'https://apps.shopify.com/avada-pdf-invoice?utm_source=landing_page&utm_medium=card_app_collection&utm_campaign=bfcm',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get PDF Invoice Code'
            },
            'SEA Survey': {
                code: 'BFCMSURVEY50',
                url: 'https://apps.shopify.com/sea-survey?utm_source=landing_page&utm_medium=card_app_collection&utm_campaign=bfcm',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get SEA Survey Code'
            },
            'Avada Order Limit': {
                code: 'BFCM2025M',
                url: 'https://apps.shopify.com/avada-order-limit?utm_source=landing_page&utm_medium=card_app_collection&utm_campaign=bfcm',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get Order Limit Code'
            },
            'Joy Subscriptions': {
                code: 'BFCM',
                url: 'https://apps.shopify.com/joy-subscription?utm_source=landing_page&utm_medium=card_app_collection&utm_campaign=bfcm',
                textUrl_landingpage: '',
                url_landingpage: '',
                textBtn_getcode: 'Get Joy Subscriptions Code'
            },
        };

        const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbwDZJOucKibIo_pKyg6ybzmxQqec-N_2KieB8F3DcRWZcCL0WANDm09lONJuBHsFRLW9Q/exec';

        const modalDeals = typeof UIkit !== 'undefined' ? UIkit.modal('#email-deals') : null;
        const modalCoupon = typeof UIkit !== 'undefined' ? UIkit.modal('#email-coupon') : null;

        // When user clicks "Claim Now" on an app card
        document.querySelectorAll('#app-deals .has-coupon .uk-button').forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();

                const row = btn.closest('.table-row-data');
                const appName = row?.querySelector('.el-title')?.innerText?.trim() || '';
                console.log(appName);

                // Fill app name into modal and hidden input
                document.querySelector('#email-deals .asset-name').innerText = appName;
                const assetNameInput = document.querySelector('#email-deals input[name="asset-name"]');
                if (assetNameInput) assetNameInput.value = appName;

                // Set button text from coupons config
                const submitBtn = document.querySelector('.form-email-deals__btn');
                if (submitBtn && coupons[appName] && coupons[appName].textBtn_getcode) {
                    submitBtn.textContent = coupons[appName].textBtn_getcode;
                }

                // Show email modal
                if (modalDeals) modalDeals.show();
            });
        });

        // Pure JS submit (no CF7)
        const form = document.querySelector('.form-email-deals');
        if (form) {
            const statusTextEl = document.querySelector('.form-email-deals__status');
            const statusNotificationEl = document.querySelector('.form-email-deals__status-notification');
            const submitBtn = form.querySelector('.form-email-deals__btn');

            // Ensure button has visible text
            if (submitBtn && !submitBtn.textContent.trim()) {
                submitBtn.textContent = 'Get my code';
            }

            const notify = (msg, type = 'primary') => {
                if (typeof UIkit !== 'undefined' && UIkit.notification) {
                    UIkit.notification({ message: msg, status: type, pos: 'top-right' });
                } else {
                    // Fallback
                    if (type === 'danger') alert(msg);
                    else console.log(msg);
                }
            };

            const setStatusText = (text) => {
                if (statusTextEl) {
                    statusTextEl.textContent = text;
                    statusTextEl.className = 'form-email-deals__status';
                    if (text === 'success') {
                        statusTextEl.classList.add('success');
                    } else if (text === 'fail') {
                        statusTextEl.classList.add('fail');
                    }
                }
            };

            const clearStatusText = () => {
                if (statusTextEl) {
                    statusTextEl.textContent = '';
                    statusTextEl.className = 'form-email-deals__status';
                }
            };

            const setStatusNotification = (msg) => {
                if (statusNotificationEl) {
                    statusNotificationEl.textContent = msg;
                }
            };

            const clearStatusNotification = () => {
                if (statusNotificationEl) {
                    statusNotificationEl.textContent = '';
                }
            };

            const setBusy = (busy) => {
                if (!submitBtn) return;
                submitBtn.disabled = !!busy;
                submitBtn.dataset.prevText = submitBtn.dataset.prevText || submitBtn.textContent;
                submitBtn.textContent = busy ? 'Sending…' : (submitBtn.dataset.prevText || 'Get my code');
            };

            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                const emailInput = form.querySelector('input[name="email"]');
                const appInput = form.querySelector('input[name="asset-name"]');
                const hpCompany = form.querySelector('input[name="company"]');

                const email = (emailInput?.value || '').trim();
                const appName = (appInput?.value || '').trim();
                const company = (hpCompany?.value || '').trim(); // honeypot

                // Honeypot: if filled, silently abort
                if (company) {
                    // Do nothing to avoid tipping off bots
                    return;
                }

                // HTML5 validation
                if (!emailInput.checkValidity()) {
                    emailInput.reportValidity();
                    setStatusText('fail');
                    setStatusNotification('Please enter a valid email address');
                    return;
                }
                if (!appName) {
                    setStatusText('fail');
                    setStatusNotification('Missing app name. Please try again.');
                    notify('Missing app name. Please click Claim Now again.', 'warning');
                    return;
                }

                // Prepare payload
                const payload = {
                    appName: appName,
                    email: email,
                    pageUrl: window.location?.href || ''
                };

                try {
                    setStatusNotification('Sending…');
                    setBusy(true);

                    // Use text/plain to avoid CORS preflight with Apps Script
                    const res = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(payload),
                        mode: 'cors',
                        redirect: 'follow'
                    });

                    const text = await res.text();
                    let data;
                    try { data = JSON.parse(text); } catch (_) { data = { status: res.ok ? 'success' : 'error' }; }

                    if (!res.ok || data.status !== 'success') {
                        throw new Error(data?.message || `Request failed (${res.status})`);
                    }

                    // Success: hide email modal, show coupon
                    if (modalDeals) modalDeals.hide();

                    setStatusText('success');
                    setStatusNotification('Success! Showing your coupon...');

                    if (coupons[appName]) {
                        console.log('has coupons');
                        const { code, url, textUrl_landingpage, url_landingpage } = coupons[appName];
                        const couponEl = document.querySelector('#email-coupon .code-coupon');
                        const redeemEl = document.querySelector('#email-coupon a.uk-button');
                        const lpEl = document.querySelector('#email-coupon .link-landing-page');

                        if (couponEl) couponEl.textContent = code;
                        if (redeemEl) {
                            redeemEl.setAttribute('href', url);
                            redeemEl.setAttribute('target', '_blank');
                            redeemEl.textContent = 'Redeem now';
                        }

                        if (lpEl) {
                            if (textUrl_landingpage && url_landingpage) {
                                lpEl.textContent = textUrl_landingpage;
                                lpEl.setAttribute('href', url_landingpage);
                                lpEl.setAttribute('target', '_blank');
                                lpEl.style.display = '';
                            } else {
                                lpEl.textContent = '';
                                lpEl.removeAttribute('href');
                                lpEl.style.display = 'none';
                            }
                        }

                        if (modalCoupon) modalCoupon.show();
                    } else {
                        console.log('No coupons found');
                        console.log(coupons[appName]);
                        setStatusText('fail');
                        setStatusNotification('No coupon found for this app.');
                        notify('No coupon found for this app.', 'warning');
                    }

                    // Reset UI
                    clearStatusText();
                    clearStatusNotification();
                    form.reset();
                } catch (err) {
                    console.error(err);
                    setStatusText('fail');
                    setStatusNotification('Something went wrong. Please try again later.');
                    notify('Failed to submit. Please try again later.', 'danger');
                } finally {
                    setBusy(false);
                }
            });
        }
    });

</script>