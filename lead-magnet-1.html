========================================
üìã H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG FORM LEAD MAGNET
========================================

üéØ M·ª§C ƒê√çCH
-----------
Form n√†y thu th·∫≠p email c·ªßa kh√°ch h√†ng ti·ªÅm nƒÉng v√† cung c·∫•p t√†i li·ªáu "Black Friday Marketing Checklist 2025" mi·ªÖn ph√≠.

‚öôÔ∏è C√ÄI ƒê·∫∂T
-----------

B∆Ø·ªöC 1: Thi·∫øt l·∫≠p Google Sheets
- T·∫°o m·ªôt Google Sheets m·ªõi
- V√†o Extensions > Apps Script
- Sao ch√©p ƒëo·∫°n code trong comment v√†o Apps Script:

function doPost(e) { 
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); 
    var data = JSON.parse(e.postData.contents || '{}'); 
    var email = data.email || ''; 
    var url = data.url || ''; 
    sheet.appendRow([new Date(), email, url]);
    return ContentService.createTextOutput('OK').setMimeType(ContentService.MimeType.TEXT); 
}

- L∆∞u v√† deploy v·ªõi quy·ªÅn "Anyone"
- Copy URL webhook v√† thay th·∫ø v√†o bi·∫øn scriptURL trong code

B∆Ø·ªöC 2: C·∫≠p nh·∫≠t URL t√†i li·ªáu
- T√¨m d√≤ng: const checklistUrl = 'https://docs.google.com/...'
- Thay b·∫±ng link Google Docs c·ªßa b·∫°n

üîß T√çNH NƒÇNG
-------------

‚úÖ B·∫£o m·∫≠t:
- Honeypot: Ch·ªëng bot spam v·ªõi tr∆∞·ªùng ·∫©n "company"
- Validation: Ki·ªÉm tra ƒë·ªãnh d·∫°ng email h·ª£p l·ªá
- Rate limiting: NgƒÉn submit li√™n t·ª•c

üì± Responsive:
- T·ª± ƒë·ªông chuy·ªÉn layout d·ªçc tr√™n mobile (< 480px)
- Ho·∫°t ƒë·ªông t·ªët tr√™n m·ªçi thi·∫øt b·ªã

‚ôø Accessibility:
- ARIA labels v√† roles
- H·ªó tr·ª£ screen reader
- ƒêi·ªÅu h∆∞·ªõng b·∫±ng b√†n ph√≠m

üíæ Tr·∫£i nghi·ªám ng∆∞·ªùi d√πng:
- LocalStorage: L∆∞u email ƒë·ªÉ l·∫ßn sau kh√¥ng ph·∫£i nh·∫≠p l·∫°i
- M·ªü t√†i li·ªáu ngay l·∫≠p t·ª©c
- Th√¥ng b√°o r√µ r√†ng cho user

üìä D·ªÆ LI·ªÜU THU ƒê∆Ø·ª¢C
--------------------
Form s·∫Ω ghi v√†o Google Sheets:
- C·ªôt A: Th·ªùi gian submit
- C·ªôt B: Email address  
- C·ªôt C: URL trang web

üé® T√ôY CH·ªàNH
------------

Thay ƒë·ªïi m√†u s·∫Øc:
- T√¨m: background: linear-gradient(90deg, #3A0CA3, #4361EE);
- Thay b·∫±ng m√£ m√†u b·∫°n mu·ªën

Thay ƒë·ªïi n·ªôi dung:
- Ti√™u ƒë·ªÅ: S·ª≠a text trong class="email-box__title"
- M√¥ t·∫£: S·ª≠a text trong class="email-box__desc"  
- Button: S·ª≠a button.textContent trong JavaScript

üöÄ TRI·ªÇN KHAI
-------------
1. Upload file HTML l√™n server
2. ƒê·∫£m b·∫£o ·∫£nh icon c√≥ th·ªÉ truy c·∫≠p ƒë∆∞·ª£c
3. Test form tr√™n nhi·ªÅu thi·∫øt b·ªã
4. Ki·ªÉm tra Google Sheets c√≥ nh·∫≠n ƒë∆∞·ª£c data kh√¥ng

üîç TROUBLESHOOTING
------------------

V·∫•n ƒë·ªÅ: Form kh√¥ng submit ƒë∆∞·ª£c
Gi·∫£i ph√°p:
- Ki·ªÉm tra scriptURL c√≥ ƒë√∫ng kh√¥ng
- ƒê·∫£m b·∫£o Google Apps Script ƒë√£ deploy  
- M·ªü console browser ƒë·ªÉ xem l·ªói

V·∫•n ƒë·ªÅ: Kh√¥ng m·ªü ƒë∆∞·ª£c t√†i li·ªáu
Gi·∫£i ph√°p:
- Ki·ªÉm tra checklistUrl
- ƒê·∫£m b·∫£o Google Docs c√≥ quy·ªÅn "Anyone with link"
- Test link tr·ª±c ti·∫øp

üí° PRO TIPS
-----------
- Th√™m Google Analytics ƒë·ªÉ track conversion
- A/B test c√°c button text kh√°c nhau
- T√≠ch h·ª£p v·ªõi email marketing tools (Mailchimp, etc.)
- Th√™m social proof (VD: "ƒê√£ c√≥ 5,000+ ng∆∞·ªùi t·∫£i xu·ªëng")

========================================


<!--
// app script for Google Sheets to handle form submissions
function doPost(e) { 
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); 
  var data = JSON.parse(e.postData.contents || '{}'); 
  var email = data.email || ''; 
  var url = data.url || ''; 
  sheet.appendRow([new Date(), email, url]); // A: time, B: email, C: URL 
  return ContentService.createTextOutput('OK') .setMimeType(ContentService.MimeType.TEXT); 
} 
-->


<div>
    <div class="email-box" role="region" aria-labelledby="email-box-title">
        <div class="email-box__title" id="email-box-title">
            <img style="margin:0 !important;" src="http://localhost/avada-staging/wp-content/uploads/2025/09/list-magnent-1.webp" alt="icon" width="512" height="512" loading="lazy" decoding="async" fetchpriority="auto">
            Black Friday Marketing Checklist 2025
        </div>
        <p class="email-box__desc" style="text-align: left !important;">
            A condensed playbook to maximize sales and minimize budget.
        </p>
        <form class="email-box__form" novalidate="">
            <label for="lead-email" class="sr-only">Email address</label>
            <input id="lead-email" name="email" type="email" placeholder="Enter your email" class="email-box__input" autocomplete="email" inputmode="email" required="" aria-describedby="email-status">
            <!-- Honeypot for bots: keep visible to DOM but hidden off-screen -->
            <label for="lead-company" class="sr-only">Company</label>
            <input id="lead-company" name="company" type="text" class="email-box__hp" tabindex="-1" aria-hidden="true" autocomplete="off">

            <button type="submit" class="email-box__btn" aria-label="Get the checklist">Get the checklist</button>
        </form>
        <p class="email-box__status" id="email-status" role="status" aria-live="polite"></p>
    </div>
    <style>
        .email-box {
            background: #fff;
            border-radius: 16px;
            padding: 24px 32px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            border: 1px solid #E5E7EB;
            max-width: 100%;
            margin: 32px auto;
        }

        .email-box__title {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            color: #1C1C1C;
            gap: 8px;
        }

        .email-box__title img,
        .email-box__feature img {
            width: 24px !important;
            height: 24px !important;
        }

        .email-box__desc {
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
        }

        .email-box__feature {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .email-box__form {
            display: flex;
            gap: 12px;
            align-items: stretch;
            position: relative;
        }

        .email-box__input {
            flex: 1;
            padding: 12px 14px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .email-box__input:focus {
            outline: none;
            border-color: #4361EE;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .email-box__input:invalid {
            border-color: #ef4444;
        }

        .email-box__input:invalid:focus {
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .email-box__btn {
            white-space: nowrap;
            text-align: center;
            background: linear-gradient(90deg, #3A0CA3, #4361EE);
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
            transition: all 0.2s ease;
            display: inline-block;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .email-box__btn:hover {
            filter: brightness(1.08);
            box-shadow: 0 6px 16px rgba(67, 97, 238, 0.4);
        }

        .email-box__btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }

        .email-box__status {
            margin-top: 8px;
            margin-bottom: 0px !important;
            font-size: 14px;
            color: #374151;
            min-height: 1em;
        }

        .email-box__status.error {
            color: #ef4444;
        }

        .email-box__hp {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Mobile stacking */
        @media (max-width: 480px) {
            .email-box__form {
                flex-direction: column;
            }

            .email-box__btn {
                width: 100%;
            }
        }
    </style>
    <script>
        (function () {
            // change your scriptURL here
            const scriptURL = 'https://script.google.com/macros/s/demo-123abcxyz/exec';
            const container = document.querySelector('.email-box');
            if (!container) return;

            const form = container.querySelector('form.email-box__form');
            const input = container.querySelector('.email-box__input');
            const button = container.querySelector('.email-box__btn');
            const status = container.querySelector('.email-box__status');
            const honeypot = container.querySelector('input[name="company"]');

            // Prefill from localStorage if available
            try {
                const saved = localStorage.getItem('lead_email');
                if (saved) input.value = saved;
            } catch (e) { /* ignore */ }

            let isSubmitting = false;

            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                if (isSubmitting) return;

                clearStatus();

                const email = (input.value || '').trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                if (!email) {
                    showError('Please enter your email!');
                    input.focus();
                    return;
                }
                if (!emailRegex.test(email)) {
                    showError('Please enter a valid email address (e.g., example@email.com)');
                    input.focus();
                    return;
                }

                // If honeypot is filled, probably a bot: pretend success
                if (honeypot && honeypot.value) {
                    openChecklist();
                    return;
                }

                isSubmitting = true;
                setLoading(true);

                // Save email for convenience next time
                try { localStorage.setItem('lead_email', email); } catch (e) { /* ignore */ }

                const pageUrl = window.location.href;

                // Open the checklist immediately to avoid any delay (change to your URL)
                const checklistUrl = 'https://docs.google.com/document/d/link-chuyen-huong/copy';
                const preOpened = window.open(checklistUrl, '_blank');

                // Abort fetch if it hangs too long
                const controller = ('AbortController' in window) ? new AbortController() : null;
                const signal = controller ? controller.signal : undefined;
                const timeoutId = controller ? setTimeout(() => controller.abort(), 10000) : null; // 10s

                try {
                    await fetch(scriptURL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, url: pageUrl, userAgent: navigator.userAgent }),
                        signal
                    }).catch(function () { /* swallow since no-cors gives opaque */ });
                    announce('Your checklist is opening in a new tab...');
                } catch (err) {
                    // Even on error (timeout/abort), continue to open checklist for user experience
                    announce('Network is slow. Opening your checklist...');
                } finally {
                    if (timeoutId) clearTimeout(timeoutId);
                    input.value = '';
                    setLoading(false);
                    isSubmitting = false;
                    // Clear message after a moment to reduce clutter
                    setTimeout(clearStatus, 4000);
                }
            });

            function setLoading(loading) {
                button.disabled = loading;
                button.setAttribute('aria-busy', String(loading));
                button.textContent = loading ? 'Submitting...' : 'Get the checklist';
            }

            function announce(message) {
                if (status) {
                    status.classList.remove('error');
                    status.textContent = message;
                }
            }

            function showError(message) {
                if (status) {
                    status.textContent = message;
                    status.classList.add('error');
                } else {
                    alert(message);
                }
            }

            function clearStatus() {
                if (status) {
                    status.textContent = '';
                    status.classList.remove('error');
                }
            }

            // openChecklist helper no longer needed since we navigate immediately
        })();
    </script>
</div>